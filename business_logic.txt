Bảng Phần thưởng (lucky_spin_prizes)
Dùng để cấu hình xem vòng quay có những ô nào, tỷ lệ ra sao.

SQL
CREATE TABLE lucky_spin_prizes (
    id INTEGER PRIMARY KEY,
    name TEXT NOT NULL,              -- Tên hiển thị (VD: Thẻ 50k, Chúc may mắn)
    type TEXT NOT NULL DEFAULT 'TEXT', -- Loại quà: 'REAL' (Hiện vật), 'CODE' (Mã giảm giá), 'TEXT' (Lời chúc/Mất lượt)
    value TEXT,                      -- Giá trị thực (VD: Mã thẻ cào, mệnh giá tiền)
    probability INTEGER NOT NULL DEFAULT 0, -- Tỷ lệ trúng (Ví dụ: nhập 10 là 10%, 0.5 là 0.5%)
    quantity INTEGER DEFAULT -1,     -- Số lượng tồn kho (-1 là vô hạn, >0 là số lượng cụ thể)
    image TEXT,                      -- Đường dẫn ảnh icon
    is_active INTEGER DEFAULT 1      -- 1: Đang dùng, 0: Tạm ẩn
);
Logic xử lý tỷ lệ: Khi quay, bạn sẽ lấy danh sách giải thưởng, tính tổng trọng số probability và random trong khoảng đó. Ví dụ giải A (1%), Giải B (99%) -> Random từ 1-100, rơi vào 1 là trúng A.

2. Bảng Người chơi (lucky_spin_players)
Dùng để quản lý số lượt quay của từng SĐT/Email.

SQL
CREATE TABLE lucky_spin_players (
    id INTEGER PRIMARY KEY,
    identifier TEXT NOT NULL UNIQUE, -- Lưu Email hoặc Số điện thoại người chơi nhập
    total_turns INTEGER DEFAULT 1,   -- Tổng số lượt họ ĐƯỢC PHÉP quay (Admin có thể sửa số này)
    used_turns INTEGER DEFAULT 0,    -- Số lượt ĐÃ quay
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
Logic:

Khi người dùng nhập SĐT/Email -> Hệ thống check trong bảng này.

Nếu chưa có -> Tạo mới (Insert) với total_turns mặc định (ví dụ 1 lần).

Nếu có rồi -> Check xem used_turns < total_turns không? Nếu còn thì cho quay.

Đáp ứng yêu cầu của bạn: Muốn cho ai quay thêm, bạn chỉ cần Update total_turns của người đó lên (ví dụ từ 1 thành 5).

3. Bảng Lịch sử trúng thưởng (lucky_spin_history)
Lưu lại bằng chứng trúng thưởng để đối soát.

SQL
CREATE TABLE lucky_spin_history (
    id INTEGER PRIMARY KEY,
    player_id INTEGER NOT NULL,      -- Link tới bảng players
    prize_id INTEGER,                -- Link tới bảng prizes (Có thể NULL nếu giải đó bị xóa sau này)
    prize_name TEXT NOT NULL,        -- Lưu cứng tên giải lúc trúng (đề phòng sau này sửa tên giải)
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (player_id) REFERENCES lucky_spin_players(id),
    FOREIGN KEY (prize_id) REFERENCES lucky_spin_prizes(id)
);